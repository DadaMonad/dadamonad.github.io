!function n(t,e,r){function o(c,i){if(!e[c]){if(!t[c]){var u="function"==typeof require&&require;if(!i&&u)return u(c,!0);if(s)return s(c,!0);throw new Error("Cannot find module '"+c+"'")}var a=e[c]={exports:{}};t[c][0].call(a.exports,function(n){var e=t[c][1][n];return o(e?e:n)},a,a.exports,n,t,e,r)}return e[c].exports}for(var s="function"==typeof require&&require,c=0;c<r.length;c++)o(r[c]);return o}({1:[function(n,t){var e;e=function(){function n(){this.is_synced=!1,this.compute_when_synced=[],this.connections={},this.unsynced_connections={},this.receive_handlers=[],this.sync_process_order=[],this.when_user_id_set=[]}return n.prototype.getUniqueConnectionId=function(){return this.id},n.prototype.whenUserIdSet=function(n){return this.when_user_id_set.push(n)},n.prototype.whenSynced=function(n){return this.is_synced?n[0].apply(this,n.slice(1)):this.compute_when_synced.push(n)},n.prototype.whenReceiving=function(n){return this.receive_handlers.push(n)},n.prototype.multicast=function(n,t){return this.whenSynced([_send,n,t])},n.prototype.unicast=function(n,t){return this.whenSynced([_send,n,t])},n.prototype.broadcast=function(n){return this._broadcast(n)},n.prototype.whenSyncing=function(){var n,t,e,r;for(r=[],n=t=e=arguments.length-1;0>=e?0>=t:t>=0;n=0>=e?++t:--t)r.push(this.sync_process_order.unshift(arguments[n]));return r},n}(),t.exports=e},{}],2:[function(n){var t,e,r,o,s,c=function(n,t){return function(){return n.apply(t,arguments)}},i={}.hasOwnProperty,u=function(n,t){function e(){this.constructor=n}for(var r in t)i.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n};s=function(n,t,e){var r,o,s,c,i;return r=function(n,t){var e,r;return r=Strophe.escapeNode(Strophe.getNodeFromJid(n)),e=Strophe.getDomainFromJid(n),r+"@"+e+(null!=t?"/"+t:"")},i=null!=t?"chat":"groupchat",c=r(n,t),s=this.getUniqueId(),o=$msg({to:c,from:this.jid,type:i,id:s}),window.message=e,window.encoded_message=(new DOMParser).parseFromString(e,"text/xml").querySelector("yatta"),o.cnode(window.encoded_message),o.up().up(),this.send(o),s},t=n("../connector"),o=function(n){var t,e;return t=function(n){var r,o,s,c,i;for(c=n.children,i=[],o=0,s=c.length;s>o;o++)r=c[o],i.push("true"===r.getAttribute("isArrayContainer")?t(r):e(r));return i},(e=function(n){var r,o,s,c,i,u,a,p,l,d,_;for(s={},d=n.attributes,u=0,p=d.length;p>u;u++)r=d[u],o=parseInt(r.value),s[r.name]=isNaN(o)||""+o!==r.value?r.value:o;for(_=n.children,a=0,l=_.length;l>a;a++)c=_[a],i=c.tagName.toLowerCase(),s[i]="true"===c.getAttribute("isArrayContainer")?t(c):e(c);return s})(n.querySelector("yatta"))},r=function(n){var t,e;return e=function(n,r,o){var s,c,i,u;c="<"+n,null!=o&&(c+=" "+o),s="";for(i in r)u=r[i],null==u||(u.constructor===Object?s+=e(i,u):u.constructor===Array?s+=t(i,u):c+=" "+i+'="'+u+'"');return c+">"+s+"</"+n+">"},t=function(n,r){var o,s,c,i;for(o="<"+n+' isArrayContainer="true">',c=0,i=r.length;i>c;c++)s=r[c],o+=s.constructor===Object?e("array-element",s):t("array-element",s);return o+="</"+n+">"},e("yatta",n,'xmlns="http://yatta.ninja/connector-stanza"')},Strophe.log=function(n,t){return console.log("STROPHE: "+t)},window.StrohpeConnector=e=function(n){function t(n){var e;this.room=null!=n?n:"thing",this.invokeSync=c(this.invokeSync,this),t.__super__.constructor.call(this),e=this,this.room=this.room+"@conference.yatta.ninja",this.unsynced_connections={},this.xmpp=new Strophe.Connection("wss:yatta.ninja:5281/xmpp-websocket"),this.xmpp.send_yatta_element=s,this.xmpp.rawInput=function(n){return console.log("Receive: "+n)},this.xmpp.rawOutput=function(n){return console.log("Send: "+n)},this.xmpp.connect("yatta.ninja","anonymous",function(n){return n===Strophe.Status.CONNECTED?(e.xmpp.muc.join(e.room,e.xmpp.jid.split("/")[1]),e.xmpp.muc.rooms[e.room].addHandler("presence",function(n,t){var s,c,i,u,a,p,l;for(e.conn=t,e.connections=e.conn.roster,e.id=e.conn.nick,l=e.when_user_id_set,a=0,p=l.length;p>a;a++)(s=l[a])(e.id);return i=function(n){var t,r,o,s;for(delete e.unsynced_connections[n],e.is_synced=!0,s=e.compute_when_synced,r=0,o=s.length;o>r;r++)t=s[r],t[0].apply(e,t.slice(1));return e.compute_when_synced=[]},e.conn.addHandler("message",function(n){var t,c,a,p,l,d,_;if(p=n.getAttribute("from").split("/")[1],p===e.conn.nick)return!0;if(c=n.querySelector("error"),null!=c)return console.log("STROPHE: STANZA-ERROR: "+c.textContent),u()&&e.conn.addHandler("presence",u),!0;if(a=o(n),console.log("received sth:"+(null!=a.sync_step?" - sync_step: "+a.sync_step:"")),console.dir(a.data),null!=a.sync_step)a.sync_step+1<e.sync_process_order.length?(0===a.sync_step&&null==e.unsynced_connections[p]&&"true"!==a.stamped&&e.xmpp.send_yatta_element(e.room,p,r({sync_step:0,data:e.sync_process_order[0].call(e),stamped:!0})),null==e.unsynced_connections[p]&&(e.unsynced_connections[p]=a.sync_step),(null==e.unsynced_connections[p]||e.unsynced_connections[p]<=a.sync_step)&&(t=e.sync_process_order[a.sync_step+1].call(e,a.data),null!=e.sync_process_order[a.sync_step+2]?(e.unsynced_connections[p]=a.sync_step+1,e.is_synced?e.xmpp.send_yatta_element(e.room,p,r({sync_step:a.sync_step+1,data:t})):(t.state_vector=[],e.xmpp.send_yatta_element(e.room,null,r({sync_step:a.sync_step+1,data:t})))):i(p))):i(p);else for(_=e.receive_handlers,l=0,d=_.length;d>l;l++)(s=_[l])(p,a.data);return!0}),c=function(){var n,t,r,o;return n=function(){var n,r;n=e.connections,r=[];for(t in n)o=n[t],r.push(o);return r}(),r=n.length,n=n.filter(function(n){return n.nick!==e.conn.nick}),n.length>0?n[Math.round(Math.random()*(n.length-1))].nick:null},u=function(){var n;return n=c(),null!=n?(e._isSyncing()||(e.unsynced_connections[n]=0,e.xmpp.send_yatta_element(e.room,n,r({sync_step:0,data:e.sync_process_order[0].call(e)}))),!1):!0},u()&&e.conn.addHandler("presence",u),e.whenSynced([function(){var n;return(n=function(){return e.xmpp.send_yatta_element(e.room,null,r({sync_step:0,data:e.sync_process_order[0].call(e)}))})()}]),!1})):void 0})}return u(t,n),t.prototype._isSyncing=function(){var n,t;t=!1;for(n in this.unsynced_connections){t=!0;break}return t},t.prototype.invokeSync=function(){return this.is_synced?this.xmpp.send_yatta_element(this.room,null,r({sync_step:0,data:this.sync_process_order[0].call(this)})):void 0},t.prototype._broadcast=function(n){return null!=this.conn&&this.is_synced?this.xmpp.send_yatta_element(this.room,null,r({data:n})):void 0},t.prototype._send=function(n,t){var e,o,s,c,i;if(n.constructor!==[].constructor)return this.xmpp.send_yatta_element(this.room,this.connections[n].nick,r({data:t}));for(o=[],c=0,i=n.length;i>c;c++){s=n[c];try{this.xmpp.send_yatta_element(this.room,this.connections[s].nick,r({data:t}))}catch(u){e=u,o.push(e+"")}}if(o.length>0)throw new Error(o)},t}(t)},{"../connector":1}]},{},[2]);