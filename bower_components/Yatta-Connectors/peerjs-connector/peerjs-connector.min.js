!function n(t,e,r){function o(s,i){if(!e[s]){if(!t[s]){var u="function"==typeof require&&require;if(!i&&u)return u(s,!0);if(c)return c(s,!0);throw new Error("Cannot find module '"+s+"'")}var h=e[s]={exports:{}};t[s][0].call(h.exports,function(n){var e=t[s][1][n];return o(e?e:n)},h,h.exports,n,t,e,r)}return e[s].exports}for(var c="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(n,t){var e;e=function(){function n(){this.is_synced=!1,this.compute_when_synced=[],this.connections={},this.unsynced_connections={},this.receive_handlers=[],this.sync_process_order=[],this.when_user_id_set=[]}return n.prototype.getUniqueConnectionId=function(){return this.id},n.prototype.whenUserIdSet=function(n){return this.when_user_id_set.push(n)},n.prototype.whenSynced=function(n){return n.constructore===Function&&(n=[n]),this.is_synced?n[0].apply(this,n.slice(1)):this.compute_when_synced.push(n)},n.prototype.whenReceiving=function(n){return this.receive_handlers.push(n)},n.prototype.multicast=function(n,t){return this.whenSynced([_send,n,t])},n.prototype.unicast=function(n,t){return this.whenSynced([_send,n,t])},n.prototype.broadcast=function(n){return this._broadcast(n)},n.prototype.whenSyncing=function(){var n,t,e,r;for(r=[],n=t=e=arguments.length-1;0>=e?0>=t:t>=0;n=0>=e?++t:--t)r.push(this.sync_process_order.unshift(arguments[n]));return r},n}(),t.exports=e},{}],2:[function(n){var t,e,r=function(n,t){return function(){return n.apply(t,arguments)}},o={}.hasOwnProperty,c=function(n,t){function e(){this.constructor=n}for(var r in t)o.call(t,r)&&(n[r]=t[r]);return e.prototype=t.prototype,n.prototype=new e,n.__super__=t.prototype,n};t=n("../connector"),window.PeerJsConnector=e=function(n){function t(n,e){var o;this.id=n,this._addConnection=r(this._addConnection,this),t.__super__.constructor.call(this),o=this,this.sync_process_order.push(function(){var n,t,e;return e=function(){var e,r;e=o.connections,r=[];for(t in e)n=e[t],r.push(t);return r}()}),this.sync_process_order.push(function(n){var t,e,r;for(e=0,r=n.length;r>e;e++)t=n[e],o.join(t);return!0}),this.conn=new Peer(this.id,e),this.conn.on("error",function(n){throw new Error("Peerjs connector: "+n)}),this.conn.on("disconnected",function(){throw new Error("Peerjs connector disconnected from signalling server. Cannot accept new connections. Not fatal, but not so good either..")}),this.conn.on("disconnect",function(){return o.conn.reconnect()}),this.conn.on("connection",this._addConnection)}return c(t,n),t.prototype.join=function(n){var t;return null==this.unsynced_connections[n]&&null==this.connections[n]&&n!==this.id?(t=this.conn.connect(n,{reliable:!0}),this.unsynced_connections[n]=t,this._addConnection(t),!0):!1},t.prototype._broadcast=function(n){return this.whenSynced([function(t){return function(){var e,r,o,c;o=t.connections,c=[];for(r in o)e=o[r],c.push(t._send(r,n));return c}}(this)])},t.prototype._send=function(n,t){var e,r,o,c,s;if(n.constructor!==[].constructor)return this.connections[n].send(t);for(r=[],c=0,s=n.length;s>c;c++){o=n[c];try{this.connections[o].send(t)}catch(i){e=i,r.push(e+"")}}if(r.length>0)throw new Error(r)},t.prototype._addConnection=function(n){return n.on("open",function(t){return function(){var e,r;return r=t,n.send(r.sync_process_order[0]()),e=1,n.on("data",function(t){var o,c,s,i,u,h,p,d,f,_;if(console.log("receive data: "+JSON.stringify(t)),e<r.sync_process_order.length)return n.send(r.sync_process_order[e++].call(r,t));if(e!==r.sync_process_order.length){for(f=r.receive_handlers,_=[],u=0,p=f.length;p>u;u++)c=f[u],_.push(c(n.peer,t));return _}if(e++,delete r.unsynced_connections[n.peer],r.connections[n.peer]=n,n.on("close",function(){return delete r.connections[n.peer]}),(s=function(n){var t;for(t in n)return!1;return!0})(r.unsynced_connections)){for(r.is_synced=!0,d=r.compute_when_synced,i=0,h=d.length;h>i;i++)o=d[i],o[0].apply(r,o.slice(1));return r.compute_when_synced=[]}})}}(this))},t}(t)},{"../connector":1}]},{},[2]);