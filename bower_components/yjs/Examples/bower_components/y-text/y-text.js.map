{"version":3,"sources":["../yjs/node_modules/browser-pack/_prelude.js","src/Text.js","y-text.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","extend","Y","requestModules","then","YText","_Y$Array$typeDefiniti","os","_model","_content","this","_this","getPrototypeOf","textfields","aceInstances","_createClass","key","unbindAll","_get","map","c","val","join","pos","content","split","unbindTextarea","editor","_i","unbindAce","ace","findIndex","binding","unobserve","yCallback","off","aceCallback","splice","options","mutualExcluse","token","delta","start","aceDocument","getSession","getDocument","action","positionToIndex","insert","lines","setMarker","end","klazz","disableMarkers","offset","row","column","range","Range","marker","session","addMarker","markers","push","id","timestamp","Date","now","event","type","indexToPosition","index","values","_start","_end","remove","_typeof","setValue","toString","on","inteval","clearInterval","setInterval","timeVisible","removeMarker","window","observe","arguments","Element","bindTextarea","apply","bindAce","console","error","textarea","onkeydown","onkeyup","onkeypress","onpaste","oncut","textfield","domRoot","creatorToken","oPos","fix","cursor","createRange","writeRange","getSelection","word","writeContent","selectionStart","setSelectionRange","left","right","selectionEnd","clength","textContent","Math","min","anchorOffset","focusOffset","editedElement","focusNode","childNodes","isReal","textnode","max","document","setStart","setEnd","removeAllRanges","addRange","contentArray","replace","RegExp","innerText","innerHTML","is_deleted","char","keyCode","charCode","String","fromCharCode","diff","abs","preventDefault","ctrlKey","newPos","delLength","Array","typeDefinition","utils","CustomTypeDefinition","name","class","struct","initType","regeneratorRuntime","mark","YTextInitializer","model","wrap","_context","prev","next","delegateYield","Struct","List","op","hasOwnProperty","forEach","abrupt","stop","createType","Symbol","iterator","obj","defineProperties","target","props","descriptor","defineProperty","protoProps","staticProps","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","undefined","parent","getter"],"mappings":"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","file":"y-text.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y, Element */\n'use strict'\n\nfunction extend (Y) {\n  Y.requestModules(['Array']).then(function () {\n    class YText extends Y.Array.typeDefinition['class'] {\n      constructor (os, _model, _content) {\n        super(os, _model, _content)\n        this.textfields = []\n        this.aceInstances = []\n      }\n      _destroy () {\n        this.unbindAll()\n        this.textfields = null\n        this.aceInstances = null\n        super._destroy()\n      }\n      toString () {\n        return this._content.map(function (c) {\n          return c.val\n        }).join('')\n      }\n      insert (pos, content) {\n        super.insert(pos, content.split(''))\n      }\n      unbindAll () {\n        for (let i = this.textfields.length - 1; i >= 0; i--) {\n          this.unbindTextarea(this.textfields[i].editor)\n        }\n        for (let i = this.aceInstances.length - 1; i >= 0; i--) {\n          this.unbindAce(this.aceInstances[i].editor)\n        }\n      }\n      unbindAce (ace) {\n        var i = this.aceInstances.findIndex(function (binding) {\n          return binding.editor === ace\n        })\n        if (i >= 0) {\n          var binding = this.aceInstances[i]\n          this.unobserve(binding.yCallback)\n          binding.editor.off('change', binding.aceCallback)\n          this.aceInstances.splice(i, 1)\n        }\n      }\n      bindAce (ace, options) {\n        var self = this\n\n        // this function makes sure that either the\n        // ace event is executed, or the yjs observer is executed\n        var token = true\n        function mutualExcluse (f) {\n          if (token) {\n            token = false\n            try {\n              f()\n            } catch (e) {\n              token = true\n              throw new Error(e)\n            }\n            token = true\n          }\n        }\n        ace.markers = []\n        var disableMarkers = false\n\n        if (typeof options === 'object') {\n          if (typeof options.disableMarkers !== 'undefined') {\n            disableMarkers = options.disableMarkers\n          }\n        }\n\n        ace.setValue(this.toString())\n\n        function aceCallback (delta) {\n          mutualExcluse(function () {\n            var start = 0\n            var length = 0\n\n            var aceDocument = ace.getSession().getDocument()\n            if (delta.action === 'insert') {\n              start = aceDocument.positionToIndex(delta.start, 0)\n              self.insert(start, delta.lines.join('\\n'))\n            } else if (delta.action === 'remove') {\n              start = aceDocument.positionToIndex(delta.start, 0)\n              length = delta.lines.join('\\n').length\n              self.delete(start, length)\n            }\n          })\n        }\n        ace.on('change', aceCallback)\n\n        if (!disableMarkers) {\n          if (this.inteval) {\n            clearInterval(this.inteval)\n          }\n          this.inteval = setInterval(function () {\n            var i = 0\n            var now = Date.now()\n            var timeVisible = 800\n\n            while (i < ace.markers.length) {\n              var marker = ace.markers[i]\n\n              if (marker.timestamp + timeVisible < now) {\n                ace.getSession().removeMarker(marker.id)\n                ace.markers.splice(i, 1)\n                i--\n              }\n              i++\n            }\n          }, 1000)\n        }\n        var Range = window.ace.require('ace/range').Range\n        function setMarker (start, end, klazz) {\n          if (disableMarkers) {\n            return\n          }\n          var offset = 0\n          if (start.row === end.row && start.column === end.column) {\n            offset = 1\n          }\n          var range = new Range(start.row, start.column, end.row, end.column + offset)\n          var marker = ace.session.addMarker(range, klazz, 'text')\n          ace.markers.push({id: marker, timestamp: Date.now()})\n        }\n\n        function yCallback (event) {\n          var aceDocument = ace.getSession().getDocument()\n          mutualExcluse(function () {\n            if (event.type === 'insert') {\n              let start = aceDocument.indexToPosition(event.index, 0)\n              let end = aceDocument.indexToPosition(event.index + event.length, 0)\n              aceDocument.insert(start, event.values.join(''))\n\n              setMarker(start, end, 'inserted')\n            } else if (event.type === 'delete') {\n              let start = aceDocument.indexToPosition(event.index, 0)\n              let end = aceDocument.indexToPosition(event.index + event.length, 0)\n              var range = new Range(start.row, start.column, end.row, end.column)\n              aceDocument.remove(range)\n\n              setMarker(start, end, 'deleted')\n            }\n          })\n        }\n        this.observe(yCallback)\n        this.aceInstances.push({\n          editor: ace,\n          yCallback: yCallback,\n          aceCallback: aceCallback\n        })\n      }\n      bind () {\n        var e = arguments[0]\n        if (e instanceof Element) {\n          this.bindTextarea.apply(this, arguments)\n        } else if (e != null && e.session != null && e.getSession != null && e.setValue != null) {\n          this.bindAce.apply(this, arguments)\n        } else {\n          console.error('Cannot bind, unsupported editor!')\n        }\n      }\n      unbindTextarea (textarea) {\n        var i = this.textfields.findIndex(function (binding) {\n          return binding.editor === textarea\n        })\n        if (i >= 0) {\n          var binding = this.textfields[i]\n          this.unobserve(binding.yCallback)\n          var e = binding.editor\n          e.onkeydown = null\n          e.onkeyup = null\n          e.onkeypress = null\n          e.onpaste = null\n          e.oncut = null\n          this.textfields.splice(i, 1)\n        }\n      }\n      bindTextarea (textfield, domRoot) {\n        domRoot = domRoot || window; // eslint-disable-line\n        if (domRoot.getSelection == null) {\n          domRoot = window; // eslint-disable-line\n        }\n\n        // don't duplicate!\n        for (var t = 0; t < this.textfields.length; t++) {\n          if (this.textfields[t].editor === textfield) {\n            return\n          }\n        }\n        var creatorToken = false\n\n        var word = this\n        textfield.value = this.toString()\n\n        var createRange, writeRange, writeContent\n        if (textfield.selectionStart != null && textfield.setSelectionRange != null) {\n          createRange = function (fix) {\n            var left = textfield.selectionStart\n            var right = textfield.selectionEnd\n            if (fix != null) {\n              left = fix(left)\n              right = fix(right)\n            }\n            return {\n              left: left,\n              right: right\n            }\n          }\n          writeRange = function (range) {\n            writeContent(word.toString())\n            textfield.setSelectionRange(range.left, range.right)\n          }\n          writeContent = function (content) {\n            textfield.value = content\n          }\n        } else {\n          createRange = function (fix) {\n            var range = {}\n            var s = domRoot.getSelection()\n            var clength = textfield.textContent.length\n            range.left = Math.min(s.anchorOffset, clength)\n            range.right = Math.min(s.focusOffset, clength)\n            if (fix != null) {\n              range.left = fix(range.left)\n              range.right = fix(range.right)\n            }\n            var editedElement = s.focusNode\n            if (editedElement === textfield || editedElement === textfield.childNodes[0]) {\n              range.isReal = true\n            } else {\n              range.isReal = false\n            }\n            return range\n          }\n\n          writeRange = function (range) {\n            writeContent(word.toString())\n            var textnode = textfield.childNodes[0]\n            if (range.isReal && textnode != null) {\n              if (range.left < 0) {\n                range.left = 0\n              }\n              range.right = Math.max(range.left, range.right)\n              if (range.right > textnode.length) {\n                range.right = textnode.length\n              }\n              range.left = Math.min(range.left, range.right)\n              var r = document.createRange(); // eslint-disable-line\n              r.setStart(textnode, range.left)\n              r.setEnd(textnode, range.right)\n              var s = window.getSelection(); // eslint-disable-line\n              s.removeAllRanges()\n              s.addRange(r)\n            }\n          }\n          writeContent = function (content) {\n            var contentArray = content.replace(new RegExp('\\n', 'g'), ' ').split(' '); // eslint-disable-line\n            textfield.innerText = ''\n            for (var i = 0; i < contentArray.length; i++) {\n              var c = contentArray[i]\n              textfield.innerText += c\n              if (i !== contentArray.length - 1) {\n                textfield.innerHTML += '&nbsp;'\n              }\n            }\n          }\n        }\n        writeContent(this.toString())\n\n        function yCallback (event) {\n          if (!creatorToken) {\n            var oPos, fix\n            if (event.type === 'insert') {\n              oPos = event.index\n              fix = function (cursor) { // eslint-disable-line\n                if (cursor <= oPos) {\n                  return cursor\n                } else {\n                  cursor += 1\n                  return cursor\n                }\n              }\n              var r = createRange(fix)\n              writeRange(r)\n            } else if (event.type === 'delete') {\n              oPos = event.index\n              fix = function (cursor) { // eslint-disable-line\n                if (cursor < oPos) {\n                  return cursor\n                } else {\n                  cursor -= 1\n                  return cursor\n                }\n              }\n              r = createRange(fix)\n              writeRange(r)\n            }\n          }\n        }\n        this.observe(yCallback)\n        // consume all text-insert changes.\n        textfield.onkeypress = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onkeypress = null\n            return true\n          }\n          creatorToken = true\n          var char\n          if (event.keyCode === 13) {\n            char = '\\n'\n          } else if (event.key != null) {\n            if (event.charCode === 32) {\n              char = ' '\n            } else {\n              char = event.key\n            }\n          } else {\n            char = window.String.fromCharCode(event.keyCode); // eslint-disable-line\n          }\n          if (char.length > 1) {\n            return true\n          } else if (char.length > 0) {\n            var r = createRange()\n            var pos = Math.min(r.left, r.right, word.length)\n            var diff = Math.abs(r.right - r.left)\n            word.delete(pos, diff)\n            word.insert(pos, char)\n            r.left = pos + char.length\n            r.right = r.left\n            writeRange(r)\n          }\n          event.preventDefault()\n          creatorToken = false\n          return false\n        }\n        textfield.onpaste = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onpaste = null\n            return true\n          }\n          event.preventDefault()\n        }\n        textfield.oncut = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.oncut = null\n            return true\n          }\n          event.preventDefault()\n        }\n        //\n        // consume deletes. Note that\n        //   chrome: won't consume deletions on keypress event.\n        //   keyCode is deprecated. BUT: I don't see another way.\n        //     since event.key is not implemented in the current version of chrome.\n        //     Every browser supports keyCode. Let's stick with it for now..\n        //\n        textfield.onkeydown = function (event) {\n          creatorToken = true\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onkeydown = null\n            return true\n          }\n          var r = createRange()\n          var pos = Math.min(r.left, r.right, word.toString().length)\n          var diff = Math.abs(r.left - r.right)\n          if (event.keyCode != null && event.keyCode === 8) { // Backspace\n            if (diff > 0) {\n              word.delete(pos, diff)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            } else {\n              if (event.ctrlKey != null && event.ctrlKey) {\n                var val = word.toString()\n                var newPos = pos\n                var delLength = 0\n                if (pos > 0) {\n                  newPos--\n                  delLength++\n                }\n                while (newPos > 0 && val[newPos] !== ' ' && val[newPos] !== '\\n') {\n                  newPos--\n                  delLength++\n                }\n                word.delete(newPos, pos - newPos)\n                r.left = newPos\n                r.right = newPos\n                writeRange(r)\n              } else {\n                if (pos > 0) {\n                  word.delete(pos - 1, 1)\n                  r.left = pos - 1\n                  r.right = pos - 1\n                  writeRange(r)\n                }\n              }\n            }\n            event.preventDefault()\n            creatorToken = false\n            return false\n          } else if (event.keyCode != null && event.keyCode === 46) { // Delete\n            if (diff > 0) {\n              word.delete(pos, diff)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            } else {\n              word.delete(pos, 1)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            }\n            event.preventDefault()\n            creatorToken = false\n            return false\n          } else {\n            creatorToken = false\n            return true\n          }\n        }\n        this.textfields.push({\n          editor: textfield,\n          yCallback: yCallback\n        })\n      }\n    }\n    Y.extend('Text', new Y.utils.CustomTypeDefinition({\n      name: 'Text',\n      class: YText,\n      struct: 'List',\n      initType: function * YTextInitializer (os, model) {\n        var _content = []\n        yield* Y.Struct.List.map.call(this, model, function (op) {\n          if (op.hasOwnProperty('opContent')) {\n            throw new Error('Text must not contain types!')\n          } else {\n            op.content.forEach(function (c, i) {\n              _content.push({\n                id: [op.id[0], op.id[1] + i],\n                val: op.content[i]\n              })\n            })\n          }\n        })\n        return new YText(os, model.id, _content)\n      },\n      createType: function YTextCreator (os, model) {\n        return new YText(os, model.id, [])\n      }\n    }))\n  })\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n",null],"sourceRoot":"/source/"}