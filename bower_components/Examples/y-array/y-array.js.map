{"version":3,"sources":["../yjs/node_modules/browserify/node_modules/browser-pack/_prelude.js","src/Array.js"],"names":[],"mappings":"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","file":"y-array.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\n'use strict'\n\nfunction extend (Y) {\n  class YArray {\n    constructor (os, _model, idArray, valArray) {\n      this.os = os\n      this._model = _model\n      // Array of all the operation id's\n      this.idArray = idArray\n      // Array of all the values\n      this.valArray = valArray\n      this.eventHandler = new Y.utils.EventHandler(ops => {\n        var userEvents = []\n        for (var i in ops) {\n          var op = ops[i]\n          if (op.struct === 'Insert') {\n            let pos\n            // we check op.left only!,\n            // because op.right might not be defined when this is called\n            if (op.left === null) {\n              pos = 0\n            } else {\n              var sid = JSON.stringify(op.left)\n              pos = this.idArray.indexOf(sid) + 1\n              if (pos <= 0) {\n                throw new Error('Unexpected operation!')\n              }\n            }\n            this.idArray.splice(pos, 0, JSON.stringify(op.id))\n            this.valArray.splice(pos, 0, op.content)\n            userEvents.push({\n              type: 'insert',\n              object: this,\n              index: pos,\n              length: 1\n            })\n          } else if (op.struct === 'Delete') {\n            let pos = this.idArray.indexOf(JSON.stringify(op.target))\n            if (pos >= 0) {\n              this.idArray.splice(pos, 1)\n              this.valArray.splice(pos, 1)\n              userEvents.push({\n                type: 'delete',\n                object: this,\n                index: pos,\n                length: 1\n              })\n            }\n          } else {\n            throw new Error('Unexpected struct!')\n          }\n        }\n        this.eventHandler.callEventListeners(userEvents)\n      })\n    }\n    get length () {\n      return this.idArray.length\n    }\n    get (pos) {\n      if (pos == null || typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      return this.valArray[pos]\n    }\n    toArray () {\n      return this.valArray.slice()\n    }\n    insert (pos, contents) {\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (!(contents instanceof Array)) {\n        throw new Error('contents must be an Array of objects!')\n      }\n      if (contents.length === 0) {\n        return\n      }\n      if (pos > this.idArray.length || pos < 0) {\n        throw new Error('This position exceeds the range of the array!')\n      }\n      var mostLeft = pos === 0 ? null : JSON.parse(this.idArray[pos - 1])\n\n      var ops = []\n      var prevId = mostLeft\n      for (var i = 0; i < contents.length; i++) {\n        var op = {\n          left: prevId,\n          origin: prevId,\n          // right: mostRight,\n          // NOTE: I intentionally do not define right here, because it could be deleted\n          // at the time of creating this operation, and is therefore not defined in idArray\n          parent: this._model,\n          content: contents[i],\n          struct: 'Insert',\n          id: this.os.getNextOpId()\n        }\n        ops.push(op)\n        prevId = op.id\n      }\n      var eventHandler = this.eventHandler\n      eventHandler.awaitAndPrematurelyCall(ops)\n      this.os.requestTransaction(function *() {\n        // now we can set the right reference.\n        var mostRight\n        if (mostLeft != null) {\n          mostRight = (yield* this.getOperation(mostLeft)).right\n        } else {\n          mostRight = (yield* this.getOperation(ops[0].parent)).start\n        }\n        for (var j in ops) {\n          ops[j].right = mostRight\n        }\n        yield* this.applyCreatedOperations(ops)\n        eventHandler.awaitedInserts(ops.length)\n      })\n    }\n    delete (pos, length) {\n      if (length == null) { length = 1 }\n      if (typeof length !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (typeof pos !== 'number') {\n        throw new Error('pos must be a number!')\n      }\n      if (pos + length > this.idArray.length || pos < 0 || length < 0) {\n        throw new Error('The deletion range exceeds the range of the array!')\n      }\n      if (length === 0) {\n        return\n      }\n      var eventHandler = this.eventHandler\n      var newLeft = pos > 0 ? JSON.parse(this.idArray[pos - 1]) : null\n      var dels = []\n      for (var i = 0; i < length; i++) {\n        dels.push({\n          target: JSON.parse(this.idArray[pos + i]),\n          struct: 'Delete'\n        })\n      }\n      eventHandler.awaitAndPrematurelyCall(dels)\n      this.os.requestTransaction(function *() {\n        yield* this.applyCreatedOperations(dels)\n        eventHandler.awaitedDeletes(dels.length, newLeft)\n      })\n    }\n    observe (f) {\n      this.eventHandler.addEventListener(f)\n    }\n    * _changed (transaction, op) {\n      if (!op.deleted) {\n        if (op.struct === 'Insert') {\n          var l = op.left\n          var left\n          while (l != null) {\n            left = yield* transaction.getOperation(l)\n            if (!left.deleted) {\n              break\n            }\n            l = left.left\n          }\n          op.left = l\n        }\n        this.eventHandler.receivedOp(op)\n      }\n    }\n  }\n\n  Y.extend('Array', new Y.utils.CustomType({\n    class: YArray,\n    createType: function * YArrayCreator () {\n      var modelid = this.store.getNextOpId()\n      var model = {\n        struct: 'List',\n        type: 'Array',\n        start: null,\n        end: null,\n        id: modelid\n      }\n      yield* this.applyCreatedOperations([model])\n      return modelid\n    },\n    initType: function * YArrayInitializer (os, model) {\n      var valArray = []\n      var idArray = yield* Y.Struct.List.map.call(this, model, function (c) {\n        valArray.push(c.content)\n        return JSON.stringify(c.id)\n      })\n      return new YArray(os, model.id, idArray, valArray)\n    }\n  }))\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n"]}