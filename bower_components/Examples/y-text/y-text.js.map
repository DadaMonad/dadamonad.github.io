{"version":3,"sources":["../yjs/node_modules/browserify/node_modules/browser-pack/_prelude.js","src/Text.js"],"names":[],"mappings":"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","file":"y-text.js","sourceRoot":"/source/","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/* global Y */\n'use strict'\n\nfunction extend (Y) {\n  Y.requestModules(['Array']).then(function () {\n    class YText extends Y.Array['class'] {\n      constructor (os, _model, idArray, valArray) {\n        super(os, _model, idArray, valArray)\n        this.textfields = []\n      }\n      toString () {\n        return this.valArray.join('')\n      }\n      insert (pos, content) {\n        super.insert(pos, content.split(''))\n      }\n      bind (textfield, domRoot) {\n        domRoot = domRoot || window; // eslint-disable-line\n        if (domRoot.getSelection == null) {\n          domRoot = window;// eslint-disable-line\n        }\n\n        // don't duplicate!\n        for (var t in this.textfields) {\n          if (this.textfields[t] === textfield) {\n            return\n          }\n        }\n        var creatorToken = false\n\n        var word = this\n        textfield.value = this.toString()\n        this.textfields.push(textfield)\n        var createRange, writeRange, writeContent\n        if (textfield.selectionStart != null && textfield.setSelectionRange != null) {\n          createRange = function (fix) {\n            var left = textfield.selectionStart\n            var right = textfield.selectionEnd\n            if (fix != null) {\n              left = fix(left)\n              right = fix(right)\n            }\n            return {\n              left: left,\n              right: right\n            }\n          }\n          writeRange = function (range) {\n            writeContent(word.toString())\n            textfield.setSelectionRange(range.left, range.right)\n          }\n          writeContent = function (content) {\n            textfield.value = content\n          }\n        } else {\n          createRange = function (fix) {\n            var range = {}\n            var s = domRoot.getSelection()\n            var clength = textfield.textContent.length\n            range.left = Math.min(s.anchorOffset, clength)\n            range.right = Math.min(s.focusOffset, clength)\n            if (fix != null) {\n              range.left = fix(range.left)\n              range.right = fix(range.right)\n            }\n            var editedElement = s.focusNode\n            if (editedElement === textfield || editedElement === textfield.childNodes[0]) {\n              range.isReal = true\n            } else {\n              range.isReal = false\n            }\n            return range\n          }\n\n          writeRange = function (range) {\n            writeContent(word.toString())\n            var textnode = textfield.childNodes[0]\n            if (range.isReal && textnode != null) {\n              if (range.left < 0) {\n                range.left = 0\n              }\n              range.right = Math.max(range.left, range.right)\n              if (range.right > textnode.length) {\n                range.right = textnode.length\n              }\n              range.left = Math.min(range.left, range.right)\n              var r = document.createRange(); // eslint-disable-line\n              r.setStart(textnode, range.left)\n              r.setEnd(textnode, range.right)\n              var s = window.getSelection(); // eslint-disable-line\n              s.removeAllRanges()\n              s.addRange(r)\n            }\n          }\n          writeContent = function (content) {\n            var contentArray = content.replace(new RegExp('\\n', 'g'), ' ').split(' ');// eslint-disable-line\n            textfield.innerText = ''\n            for (var i in contentArray) {\n              var c = contentArray[i]\n              textfield.innerText += c\n              if (i !== contentArray.length - 1) {\n                textfield.innerHTML += '&nbsp;'\n              }\n            }\n          }\n        }\n        writeContent(this.toString())\n\n        this.observe(function (events) {\n          for (var e in events) {\n            var event = events[e]\n            if (!creatorToken) {\n              var oPos, fix\n              if (event.type === 'insert') {\n                oPos = event.index\n                fix = function (cursor) {// eslint-disable-line\n                  if (cursor <= oPos) {\n                    return cursor\n                  } else {\n                    cursor += 1\n                    return cursor\n                  }\n                }\n                var r = createRange(fix)\n                writeRange(r)\n              } else if (event.type === 'delete') {\n                oPos = event.index\n                fix = function (cursor) {// eslint-disable-line\n                  if (cursor < oPos) {\n                    return cursor\n                  } else {\n                    cursor -= 1\n                    return cursor\n                  }\n                }\n                r = createRange(fix)\n                writeRange(r)\n              }\n            }\n          }\n        })\n        // consume all text-insert changes.\n        textfield.onkeypress = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onkeypress = null\n            return true\n          }\n          creatorToken = true\n          var char\n          if (event.keyCode === 13) {\n            char = '\\n'\n          } else if (event.key != null) {\n            if (event.charCode === 32) {\n              char = ' '\n            } else {\n              char = event.key\n            }\n          } else {\n            char = window.String.fromCharCode(event.keyCode); // eslint-disable-line\n          }\n          if (char.length > 1) {\n            return true\n          } else if (char.length > 0) {\n            var r = createRange()\n            var pos = Math.min(r.left, r.right, word.length)\n            var diff = Math.abs(r.right - r.left)\n            word.delete(pos, diff)\n            word.insert(pos, char)\n            r.left = pos + char.length\n            r.right = r.left\n            writeRange(r)\n          }\n          event.preventDefault()\n          creatorToken = false\n          return false\n        }\n        textfield.onpaste = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onpaste = null\n            return true\n          }\n          event.preventDefault()\n        }\n        textfield.oncut = function (event) {\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.oncut = null\n            return true\n          }\n          event.preventDefault()\n        }\n        //\n        // consume deletes. Note that\n        //   chrome: won't consume deletions on keypress event.\n        //   keyCode is deprecated. BUT: I don't see another way.\n        //     since event.key is not implemented in the current version of chrome.\n        //     Every browser supports keyCode. Let's stick with it for now..\n        //\n        textfield.onkeydown = function (event) {\n          creatorToken = true\n          if (word.is_deleted) {\n            // if word is deleted, do not do anything ever again\n            textfield.onkeydown = null\n            return true\n          }\n          var r = createRange()\n          var pos = Math.min(r.left, r.right, word.toString().length)\n          var diff = Math.abs(r.left - r.right)\n          if (event.keyCode != null && event.keyCode === 8) { // Backspace\n            if (diff > 0) {\n              word.delete(pos, diff)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            } else {\n              if (event.ctrlKey != null && event.ctrlKey) {\n                var val = word.toString()\n                var newPos = pos\n                var delLength = 0\n                if (pos > 0) {\n                  newPos--\n                  delLength++\n                }\n                while (newPos > 0 && val[newPos] !== ' ' && val[newPos] !== '\\n') {\n                  newPos--\n                  delLength++\n                }\n                word.delete(newPos, pos - newPos)\n                r.left = newPos\n                r.right = newPos\n                writeRange(r)\n              } else {\n                if (pos > 0) {\n                  word.delete(pos - 1, 1)\n                  r.left = pos - 1\n                  r.right = pos - 1\n                  writeRange(r)\n                }\n              }\n            }\n            event.preventDefault()\n            creatorToken = false\n            return false\n          } else if (event.keyCode != null && event.keyCode === 46) { // Delete\n            if (diff > 0) {\n              word.delete(pos, diff)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            } else {\n              word.delete(pos, 1)\n              r.left = pos\n              r.right = pos\n              writeRange(r)\n            }\n            event.preventDefault()\n            creatorToken = false\n            return false\n          } else {\n            creatorToken = false\n            return true\n          }\n        }\n      }\n    }\n    Y.extend('Text', new Y.utils.CustomType({\n      class: YText,\n      createType: function * YTextCreator () {\n        var modelid = this.store.getNextOpId()\n        var model = {\n          start: null,\n          end: null,\n          struct: 'List',\n          type: 'Text',\n          id: modelid\n        }\n        yield* this.applyCreatedOperations([model])\n        return modelid\n      },\n      initType: function * YTextInitializer (os, model) {\n        var valArray = []\n        var idArray = yield* Y.Struct.List.map.call(this, model, function (c) {\n          valArray.push(c.content)\n          return JSON.stringify(c.id)\n        })\n        return new YText(os, model.id, idArray, valArray)\n      }\n    }))\n  })\n}\n\nmodule.exports = extend\nif (typeof Y !== 'undefined') {\n  extend(Y)\n}\n"]}